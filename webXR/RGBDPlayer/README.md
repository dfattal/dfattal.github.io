# WebXR RGBD Video Player

A WebXR application for viewing RGBD videos (RGB color on the left, depth/disparity map on the right) using a real-time view synthesis shader to create a stereoscopic 3D effect.

## Features

### Non-VR Mode (Desktop/Mobile)
- **Anaglyph 3D Display**: View RGBD videos in red/cyan anaglyph format, generated by the view synthesis shader.
- **Drag & Drop Support**: Easy video file loading.
- **Video Information**: Real-time display of video dimensions and frame rate.

### VR Mode (WebXR Headsets)
- **Real-time View Synthesis**: A custom shader generates left and right eye views from the RGBD source for a true stereoscopic experience.
- **Adjustable Depth Effect (`invZmin`)**: Control the overall depth of the 3D effect.
- **Adjustable Screen Distance**: 1m to 100m range.
- **Adjustable Focal Length**: 0.5x to 2x range (18mm to 72mm equivalent).
- **Spatial Audio**: Video sound enabled in VR mode.
- **Real-time HUD**: Displays current settings, including `invZmin`.
- **VR Controller Support**: Full gamepad integration for all controls.

## Requirements

### Browser Support
- **VR Mode**: A WebXR-compatible browser (e.g., Chrome, Edge, Oculus Browser).
- **Non-VR Mode**: Any modern browser with WebGL support.

### Hardware
- **VR Mode**: A WebXR-compatible headset (e.g., Meta Quest, Vision Pro).
- **Non-VR Mode**: Red/cyan anaglyph 3D glasses for 3D viewing.

### Video Format
- **Required**: RGBD video format (left half: RGB color, right half: depth/disparity map).
- **Supported formats**: Any HTML5 video format (MP4, WebM, etc.).

## Usage

### Getting Started
1. **Open the Application**: Navigate to `index.html` in a compatible browser.
2. **Load Your Video**: Drag and drop an RGBD video file onto the page.
3. **Non-VR Viewing**: Put on red/cyan glasses to see the anaglyph 3D effect.
4. **Enter VR Mode**: Click "Enter VR" and put on your headset.

### VR Controls

#### Left Controller
- **Thumbstick Up/Down**: Adjust depth effect (invZmin)
- **Trigger**: Increase screen distance (hold to continue moving farther)
- **Grip**: Decrease edge feathering (hold to make edges sharper)
- **X Button**: Exit VR session

#### Right Controller
- **Thumbstick Up/Down**: Adjust focal length (zoom)
- **Trigger**: Decrease screen distance (hold to continue moving closer)
- **Grip**: Increase edge feathering (hold to make edges softer)
- **A Button**: Play/pause video
- **B Button**: Toggle HUD on/off

**Note**: Thumbstick left/right is intentionally disabled to avoid interference with up/down movements.

### Understanding the Settings

#### `invZmin` (Depth Effect)
- This parameter controls the intensity of the 3D effect by scaling the disparity from the depth map. A higher `invZmin` value will result in a more pronounced 3D effect.

#### Screen Distance
- The distance from the viewer to the virtual screen.

#### Focal Length
- Simulates the camera's focal length, affecting the field of view and the size of the virtual screen.

## Technical Details

### Architecture
- **`index.html`**: Main HTML file with the UI.
- **`index.js`**: Application logic, including the view synthesis shader.
- **`PLAN.md`**: Development plan and PRD.

### Key Technologies
- **THREE.js**: 3D rendering engine.
- **WebXR**: For VR device access.
- **GLSL**: Custom view synthesis shader.

### Rendering Pipeline

#### Non-VR Mode
1. A single video texture is loaded with both RGB and depth data.
2. A custom fragment shader synthesizes left and right eye views from this texture.
3. The two views are combined into a single red/cyan anaglyph image.
4. This is rendered to a full-screen plane.

#### VR Mode
1. Two overlapping planes are created, one for each eye.
2. The same view synthesis shader is used for both.
3. For the left eye, the shader outputs the original RGB image.
4. For the right eye, the shader synthesizes a new view by shifting pixels based on the depth map and the `invZmin` value.
5. The result is a correct and comfortable stereoscopic 3D image.

## HUD Information
- **Distance**: Current screen distance in meters.
- **Focal**: Current focal length.
- **IPD**: Measured interpupillary distance.
- **`invZmin`**: Current depth effect value.
- **Status**: Video playback status (Playing/Paused).
- **Controls**: A quick reference for the controller inputs.
