<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="./modules/heic2any.js"></script>
    <title>LIF5 Parsing and Generation</title>
    <style>
        img {
            border: 1px solid black;
        }
        div {
            margin: 2px;
            box-sizing: border-box;
        }
        #log-container {
            text-align: left;
        }
        #log-container pre {
            background: #f8f8f8;
            border: 1px solid #ddd;
            padding: 10px;
            overflow-x: auto;
        }

        form {
            margin-top: 10px;
            padding: 5px;
            background-color: #eee;
            border-radius: 8px;

        }
        .form-row {
            display: flex;
            gap: 5px;
            margin-bottom: 5px;
        }

        .input-container {
            flex: 1;
            position: relative;
        }

        .input-container label {
            display: block;
            margin-bottom: 5px;
        }

        .input-container input[type="text"],
        .input-container input[type="number"] {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 8px;
        }

        .input-container input::placeholder {
            color: #888;
        }

        .input-container input:focus {
            outline: 2px solid #007bff;
            border-radius: 8px;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 220px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 100%;
            left: 50%;
            margin-left: -110px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        button {
            padding: 10px 15px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

    </style>
</head>
<body>
    <h1>LIF5 Parsing | Generation | Visualization</h1>
    <div id="UI">
        <input type="file" id="filePicker" accept=".jpg,.jpeg,.png,.heic,.heif" />
        <button id="visualize" style="display:none">Visualize</button>
        <button id="downloadBut" style="display:none">Download</button>
    </div>
    <!--    Parameter form for LDI generation-->
    <form id="image-generation-form" style="display: none;">
        <!-- Row for LDL Dilation and LDL Depth Dilation -->
        <div class="form-row">
            <div class="input-container tooltip">
                <label for="ldl_dilation">LDL Dilation:</label>
                <input type="number" id="ldl_dilation" name="ldl_dilation" value="0.01" min="0" max="0.1" step="0.0001">
                <span class="tooltiptext">The larger the better for ldl edges that are not crossing ldl layers. However, we want to keep this small for objects that do cross as this causes discontinuity between layers</span>
            </div>
            <div class="input-container tooltip">
                <label for="ldl_depth_dilation">LDL Depth Dilation:</label>
                <input type="number" id="ldl_depth_dilation" name="ldl_depth_dilation" value="0.0" min="0" max="1.0" step="0.1">
                <span class="tooltiptext">Without this, we have staircase pixelation on ldl edges. Increasing this creates a ticker edge (includes some of the background). The thicker edge has a very specific optimal value roughly when ldl_depth_dilation = 1/(200 * ldl_dilation)</span>
            </div>
        </div>

        <!-- Row for Outpaint Percent and Layers -->
        <div class="form-row">
            <div class="input-container tooltip">
                <label for="out_paint_percent">Outpaint Percent:</label>
                <input type="number" id="out_paint_percent" name="out_paint_percent" value="0.1" min="0" max="1" step="0.01">
                <span class="tooltiptext">How much to outpaint, per border in fraction image size.</span>
            </div>
            <div class="input-container tooltip">
                <label for="layers">Max Layers:</label>
                <input type="number" id="layers" name="layers" value="" placeholder="leave blank if not sure" min="2" max="10" step="1">
                <span class="tooltiptext">Set maximum number of LDL layers. Default leave blank</span>
            </div>
        </div>

        <div class="form-row">
            <div class="input-container tooltip">
                <label for="inpaint_prompt">Inpaint Prompt:</label>
                <input type="text" id="inpaint_prompt" name="inpaint_prompt" value="background without foreground object, seamless and natural">
                <span class="tooltiptext">Text prompt to guide the inpainting generation process.</span>
            </div>
        </div>
        <div class="form-row">
            <div class="input-container tooltip">
                <label for="inpaint_negative_prompt">Inpaint Negative Prompt:</label>
                <input type="text" id="inpaint_negative_prompt" name="inpaint_negative_prompt" value="text, subtitles, chair, object, people, face, human, person, animal, banner">
                <span class="tooltiptext">Negative text prompt to avoid certain elements in the inpainting generation process.</span>
            </div>
        </div>
        <div class="form-row">
            <div class="input-container tooltip">
                <label for="outpaint_prompt">Outpaint Prompt:</label>
                <input type="text" id="outpaint_prompt" name="outpaint_prompt" value="background without foreground object, seamless and natural">
                <span class="tooltiptext">Text prompt to guide the outpainting generation process.</span>
            </div>
        </div>
        <div class="form-row">
            <div class="input-container tooltip">
                <label for="outpaint_negative_prompt">Outpaint Negative Prompt:</label>
                <input type="text" id="outpaint_negative_prompt" name="outpaint_negative_prompt" value="photoframe, frame, album, small text, subtitles, object, person ,animal, banner, text, color block">
                <span class="tooltiptext">Negative text prompt to avoid certain elements in the outpainting generation process.</span>
            </div>
        </div>
        <button type="button" id="ldlSubmit" onclick="ldlFormSubmit()">Create LDI</button>
        <button type="button" onclick="ldlFormReset()" style="float: right; background-color: #666;">Reset Parameters</button>

    </form>
    <div id="log-container" style="display:none;">
            <pre id="log"></pre>
    </div>
    <div id="progress-container" style="border: 1px solid black; display:none; overflow: hidden;">
        <div id="progress-bar" style="width: 0%; height: 20px; background-color: #4CAF50;"></div>
    </div>
    <div id="lifContent"></div>
    <script>
    const ldlForm = document.getElementById("image-generation-form");
    function getLdlFormData() {
        const form = document.getElementById('image-generation-form');
        const formData = new FormData(form);
        const params = {};

        formData.forEach((value, key) => {
                params[key] = value;
        });
        params.out_paint_percent = parseFloat(params.out_paint_percent) + .000001 // avoid issue with 0

        console.log(params);
        return params;
    }

    function ldlFormReset() {
        document.getElementById('ldl_dilation').value = 0.01;
        document.getElementById('ldl_depth_dilation').value = 0.00;
        document.getElementById('inpaint_prompt').value = 'background without foreground object, seamless and natural';
        document.getElementById('inpaint_negative_prompt').value = 'text, subtitles, chair, object, people, face, human, person, animal, banner';
        document.getElementById('outpaint_prompt').value = 'background without foreground object, seamless and natural';
        document.getElementById('outpaint_negative_prompt').value = 'photoframe, frame, album, small text, subtitles, object, person ,animal, banner, text, color block';
        document.getElementById('out_paint_percent').value = 0.1;
        document.getElementById('layers').value = '';
    }
    </script>
    <script src="testLDI.js"></script>
</body>
</html>
